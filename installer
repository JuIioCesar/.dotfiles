
#!/usr/bin/env bash

#set -euo pipefail

echo "üöÄ Welcome to the dotfile finstaller!"
echo "-------------------------------------------------"
echo
export DOTFILES_PATH="$HOME/.dotfiles"
echo "üëâ  Cloning into: '$DOTFILES_PATH'"

# To test that git is installed (if not macOS will prompt an installer)
git --version

git clone --depth 1 git@github.com:juliopge/.dotfiles.git "$DOTFILES_PATH"

# Install Oh my zsh!
if [ ! -d "$HOME/.oh-my-zsh" ] 
then
    echo "‚ô¶Ô∏è Installing Oh My Zsh!"
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
else
    echo "Oh my zsh! is already installed."
fi

# Clean brew
# Remove brew and all it's packages
echo "üßπ cleaning brew"
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall.sh)"

# Install brew
echo "‚ô¶Ô∏è Installing brew"
which -s brew
if [[ $? != 0 ]] ; then
    # Install Homebrew
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
else
    echo "Brew is already installed."
fi

# Apply code and cask fix.
# git -C "/usr/local/Homebrew/Library/Taps/homebrew/homebrew-core" fetch --unshallow
# git -C "/usr/local/Homebrew/Library/Taps/homebrew/homebrew-cask" fetch --unshallow


echo "running brew bundle --file $HOME/.dotfiles/Brewfile"
brew bundle --file $HOME/.dotfiles/Brewfile

echo "ü¶Ñ finished without any errors"
